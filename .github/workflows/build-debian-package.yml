name: Build Debian Package

on:
  push:
    branches: [branchAutoPackage, master]
  pull_request:
    branches: [branchAutoPackage, master]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 

    - name: Install build tools
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential devscripts debhelper fakeroot lintian

    - name: Generate configure script
      run: autoreconf -i

    - name: Configure the project
      run: ./configure --disable-dependency-tracking

    - name: Create tarball of the project
      run: |
        tar czf myprogram_1.0.orig.tar.gz myprogram/

    - name: Create debian files
      run: |
        mkdir -p debian
        echo "Source: myprogram" > debian/control
        echo "Version: 1.0-1" >> debian/control
        echo "Section: misc" >> debian/control
        echo "Priority: optional" >> debian/control
        echo "Architecture: any" >> debian/control
        echo "Maintainer: Ksenia <cheryxso@gmail.com>" >> debian/control
        echo "Description: My program for creating Debian packages" >> debian/control
        echo "myprogram (1.0-1) unstable; urgency=low" > debian/changelog
        echo "  * Initial release." >> debian/changelog
        echo "" >> debian/changelog
        echo " -- Ksenia <cheryxso@gmail.com>  $(date -R)" >> debian/changelog
        echo "9" > debian/compat
        echo "#!/usr/bin/make -f" > debian/rules
        echo "%:" >> debian/rules
        echo "\tdh $@" >> debian/rules
        chmod +x debian/rules

    - name: Build the Debian package
      run: debuild -us -uc

    - name: Upload Debian package as an artifact
      uses: actions/upload-artifact@v4
      with:
        name: myprogram-debian-package
        path: ../*.deb
